process {
    executor = 'slurm'

    withName:generate_configs {
        container =  "${params.projectRoot}/containers/gegelati-armlearn.sif"
    }
    withName:train_tpg {
        container = null
    }
    withName:parse_results {
        container = null
    }
}


params.mini_config = 0
params.is_test = true 
params.stop_mode = 'generations' // or 'time'

if (params.is_test) {
        params.nb_generations = 1
        params.training_time = 240       // seconds
        params.training_cores = 1
        params.memory = '1 GB'
}
else{
    // 100 generations setup 
    params.nb_generations = 100
    params.training_time = 172800 // Set a capped SLURM time for safety, e.g. 172800 seconds (48 h)
    params.training_cores = 16
    params.memory = '8 GB'
}

params.nb_seeds = 10
params.data_types = ['fixedpt'] //['float', 'double'] // ['int', 'float', 'double']
params.instruction_sets = [
    [
        'instrSetName': 'l2e2_compBare',
        'useInstrTrig': false,
        'useInstrLogExp': false,
        'useInstrLog2Exp2': true,
        'useInstrZmmul' : false,
        'useInstrExpensiveArithmetic': false,
        'useInstrComparison': true 
    ],
    [
        'instrSetName': 'l2e2_compZmmul',
        'useInstrTrig': false,
        'useInstrLogExp': false,
        'useInstrLog2Exp2': true,
        'useInstrZmmul' : true,
        'useInstrExpensiveArithmetic': false,
        'useInstrComparison': true 
    ],
    [
        'instrSetName': 'l2e2_compExpAr',
        'useInstrTrig': false,
        'useInstrLogExp': false,
        'useInstrLog2Exp2': true,
        'useInstrZmmul' : false,
        'useInstrExpensiveArithmetic': true,
        'useInstrComparison': true 
    ]
    /*[
        'instrSetName': 'logexp',
        'useInstrTrig': false,
        'useInstrLogExp': true,
        'useInstrExpensiveArithmetic': true,
        'useInstrComparison': true
    ],
    [
        'instrSetName': 'trigo',
        'useInstrTrig': true,
        'useInstrLogExp': false,
        'useInstrExpensiveArithmetic': true,
        'useInstrComparison': true
    ],
    [
        'instrSetName': 'complete',
        'useInstrTrig': true,
        'useInstrLogExp': true,
        'useInstrExpensiveArithmetic': true,
        'useInstrComparison': true
    ]
    ,[
        'instrSetName': 'lowcost',
        'useInstrTrig': false,
        'useInstrLogExp': true,
        'useInstrExpensiveArithmetic': false,
        'useInstrComparison': true
    ] */
]